256c256
< 		(is_exactly_a<ncmul>(e))) {
---
> 		(is_a<ncmul>(e))) {
269c269
< 		(is_exactly_a<ncmul>(e))) {
---
> 		(is_a<ncmul>(e))) {
310,314c310,312
< 	make_flat_inserter mf(seq, true);
< 	for (auto & it : seq) {
< 		ex factor = mf.handle_factor(it, 1);
< 		append_factors(assocseq, factor);
< 	}
---
> 	
> 	for (auto & it : seq) 
> 		append_factors(assocseq, it);
